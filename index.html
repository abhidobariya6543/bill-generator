<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Voice DJ & Events ‚Äî Bill Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root {
      --gold: #c59a3d;
      --dark: #2b2b2b;
      --muted: #777;
    }

    body {
      font-family: Inter, Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
      color: var(--dark);
    }

    .container {
      max-width: 820px;
      margin: auto;
      background: #fff;
      border-radius: 10px;
      padding: 18px;
      border-top: 6px solid var(--gold);
      box-shadow: 0 6px 18px rgba(20, 20, 20, 0.06);
    }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      height: 60px;
      width: 60px;
      border-radius: 6px;
      object-fit: cover;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .brand h1 {
      margin: 0;
      font-size: 20px;
      color: var(--dark);
    }

    .brand p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .info-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .info-row>div { flex: 1; }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 14px;
    }

    th, td {
      border: 1px solid #e8e8e8;
      padding: 8px;
      text-align: left;
      vertical-align: middle;
    }

    th { background: #faf9f6; }

    button {
      background: var(--gold);
      color: #111;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-weight: 600;
      cursor: pointer;
    }

    button.ghost {
      background: transparent;
      border: 1px solid #ddd;
      color: var(--dark);
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    @media (max-width:700px) {
      .info-row { flex-direction: column; }
    }
  </style>
</head>

<body>
  <div class="container" id="bill">
    <div class="header">
      <img src="./TheVoice.jpg" class="logo" alt="The Voice DJ & Events" id="pageLogo" />
      <div class="brand">
        <h1>The Voice DJ & Events</h1>
        <p>Surat, Gujarat | üìû +91 92288 63629</p>
        <p class="muted">Professional Event & DJ Services</p>
      </div>
    </div>

    <div class="info-row">
      <div>
        <label>Customer Name</label><br />
        <input id="customerName" type="text" placeholder="Customer or client name" />
      </div>
      <div>
        <label>Date</label><br />
        <input id="billDate" type="text" readonly />
      </div>
      <div>
        <label>Bill No.</label><br />
        <input id="billNumber" type="text" readonly />
      </div>
    </div>

    <table id="itemsTable">
      <thead>
        <tr>
          <th>Item / Service</th>
          <th>Qty</th>
          <th>Price (‚Çπ)</th>
          <th>Total (‚Çπ)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="itemsBody">
        <tr>
          <td><input class="itemName" type="text" placeholder="DJ Charges, Sound Setup..." /></td>
          <td><input class="itemQty" type="number" value="1" min="1" onchange="recalc(this)" /></td>
          <td><input class="itemPrice" type="number" value="0" min="0" onchange="recalc(this)" /></td>
          <td class="itemTotal">0.00</td>
          <td><button class="ghost" onclick="removeRow(this)">Remove</button></td>
        </tr>
      </tbody>
    </table>

    <div class="actions">
      <div>
        <button onclick="addRow()">‚ûï Add Item</button>
        <button class="ghost" onclick="clearAll()">üßπ Clear All</button>
      </div>
      <div style="text-align:right;">
        <div class="muted">Grand Total</div>
        <div style="font-size:20px; font-weight:700;">‚Çπ <span id="grandTotal">0.00</span></div>
      </div>
    </div>

    <div style="display:flex; gap:10px; margin-top:14px;">
      <button onclick="downloadPDF()">‚¨áÔ∏è Download PDF</button>
      <button class="ghost" onclick="window.print()">üñ®Ô∏è Print</button>
    </div>
  </div>

  <script>
    function $(id) { return document.getElementById(id); }

    function init() {
      const today = new Date();
      $('billDate').value = today.toLocaleDateString('en-IN');
      $('billNumber').value = 'BILL-' + String(Date.now()).slice(-6);
      updateGrandTotal();
    }

    function recalc(el) {
      const tr = el.closest('tr');
      const qty = parseFloat(tr.querySelector('.itemQty').value) || 0;
      const price = parseFloat(tr.querySelector('.itemPrice').value) || 0;
      tr.querySelector('.itemTotal').textContent = (qty * price).toFixed(2);
      updateGrandTotal();
    }

    function updateGrandTotal() {
      let g = 0;
      document.querySelectorAll('.itemTotal').forEach(td => g += parseFloat(td.textContent) || 0);
      $('grandTotal').textContent = g.toFixed(2);
    }

    function addRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input class="itemName" type="text" placeholder="Item or Service" /></td>
        <td><input class="itemQty" type="number" value="1" min="1" onchange="recalc(this)" /></td>
        <td><input class="itemPrice" type="number" value="0" min="0" onchange="recalc(this)" /></td>
        <td class="itemTotal">0.00</td>
        <td><button class="ghost" onclick="removeRow(this)">Remove</button></td>`;
      $('itemsBody').appendChild(tr);
      tr.querySelector('.itemName').focus();
    }

    function removeRow(btn) { btn.closest('tr').remove(); updateGrandTotal(); }
    function clearAll() { $('itemsBody').innerHTML = ''; addRow(); updateGrandTotal(); }

    // Convert image to Base64 for safe PDF inclusion
    async function toBase64(url) {
      const res = await fetch(url);
      const blob = await res.blob();
      return new Promise(resolve => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
      });
    }

    async function downloadPDF() {
      const logoBase64 = await toBase64('./TheVoice.jpg');
      const bizName = 'The Voice DJ & Events';
      const bizInfo = 'Surat, Gujarat | üìû +91 92288 63629';
      const cust = $('customerName').value.trim() || 'Customer';
      const date = $('billDate').value;
      const billNo = $('billNumber').value;
      const grand = $('grandTotal').textContent;

      const rows = Array.from(document.querySelectorAll('#itemsBody tr'));
      const rowsHtml = rows.map(r => {
        const name = (r.querySelector('.itemName')?.value.trim()) || '';
        if (!name) return '';
        const qty = r.querySelector('.itemQty').value || '0';
        const price = (parseFloat(r.querySelector('.itemPrice').value || 0)).toFixed(2);
        const total = (parseFloat(r.querySelector('.itemTotal').textContent || 0)).toFixed(2);
        return `<tr>
          <td style="padding:8px;border:1px solid #eee">${escapeHtml(name)}</td>
          <td style="padding:8px;border:1px solid #eee;text-align:right">${escapeHtml(qty)}</td>
          <td style="padding:8px;border:1px solid #eee;text-align:right">${escapeHtml(price)}</td>
          <td style="padding:8px;border:1px solid #eee;text-align:right">${escapeHtml(total)}</td>
        </tr>`;
      }).join('');

      if (!rowsHtml.trim()) return alert('Please add at least one item before generating PDF.');

      const printable = document.createElement('div');
      printable.style.fontFamily = 'Arial, Helvetica, sans-serif';
      printable.style.padding = '22px';
      printable.style.background = '#fff';
      printable.style.position = 'relative';
      printable.innerHTML = `
        <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
          <img src="${logoBase64}" style="height:60px; width:60px; object-fit:cover; border-radius:6px;" />
          <div style="flex:1;">
            <div style="font-size:20px; font-weight:700; color:#111">${escapeHtml(bizName)}</div>
            <div style="color:#666; margin-top:3px;">${escapeHtml(bizInfo)}</div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:13px;"><strong>Date:</strong> ${escapeHtml(date)}</div>
            <div style="font-size:13px;"><strong>Bill No:</strong> ${escapeHtml(billNo)}</div>
          </div>
        </div>
        <hr style="border:none; border-top:1px solid #eee; margin:8px 0 12px;" />
        <div style="margin-bottom:10px;"><strong>Bill To:</strong> ${escapeHtml(cust)}</div>
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="background:#faf9f6;">
              <th style="padding:8px; border:1px solid #eee; text-align:left">Item / Service</th>
              <th style="padding:8px; border:1px solid #eee; text-align:right">Qty</th>
              <th style="padding:8px; border:1px solid #eee; text-align:right">Price (‚Çπ)</th>
              <th style="padding:8px; border:1px solid #eee; text-align:right">Total (‚Çπ)</th>
            </tr>
          </thead>
          <tbody>${rowsHtml}</tbody>
        </table>
        <div style="text-align:right; margin-top:14px; font-size:18px; font-weight:700;">
          Grand Total: ‚Çπ ${escapeHtml(grand)}
        </div>
        <!-- Diagonal Watermark -->
        <div style="position:absolute; top:40%; left:0; width:100%; text-align:center;
            transform:rotate(-30deg); opacity:0.1; z-index:0; pointer-events:none;">
          <span style="font-size:40px; font-weight:700; color:#c59a3d; letter-spacing:3px;">
            The Voice DJ & Events
          </span>
        </div>
        <div style="margin-top:28px; color:#777; font-size:12px;">
          Thank you for choosing ${escapeHtml(bizName)}. For queries contact ${escapeHtml(bizInfo)}
        </div>
      `;

      document.body.appendChild(printable);
      const opt = {
        margin: 0.5,
        filename: 'TheVoice_Bill.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      await new Promise(r => setTimeout(r, 150));
      await html2pdf().from(printable).set(opt).save();
      printable.remove();
    }

    function escapeHtml(s) {
      if (s == null) return '';
      return String(s).replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;').replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;').replaceAll("'", '&#039;');
    }

    init();
  </script>
</body>
</html>
